{% extends "network/layout.html" %}
{% block body %}
{% load static %}
    <div class="container">

      <form method="post" action="{% url 'new_post' %}">
        {% csrf_token %}
        <div class="form-group">
          <textarea name="text" placeholder="Write your post..." required></textarea>
        </div>
        <button type="submit">Post</button>
      </form>
  
      
      {% for post in posts %}
        <div class="post">
          <div class="post-header">
            <img src="{{ post.author.profile.photo_url }}" alt="{{ post.author.username }}">
            <p>{{ post.author.username }}</p>
          </div>
          <div class="post-body">
            <p>{{ post.text }}</p>
          </div>
          <div>
            <button class="like-button" data-post="{{ post.id }}">
              <a href="{% url 'like_post' post.id %}">
                  <img src="{% if post.user_liked > 0 %}{% static '../../../../static/network/heart1.png' %}{% else %}{% static '../../../../static/network/heart2.png' %}{% endif %}" alt="Like">
              </a>
              <a class="like-count">{{ post.likes.all.count }}</a>
           </button>
           <p class="post-date">{{ post.created_at}}</p>
          </div>
          <div class="comments">
            {% for comment in post.comment_set.all %}
            <div class="comment">
                <div class="comment-header">
                    <img src="{{ comment.user.profile.photo_url }}" alt="{{ comment.user.username }}">
                    <div class="comments-info">
                        <p><strong>{{ comment.user.username }}</strong></p>
                    </div>
                </div>
                <div class="comment-body">
                    <p>{{ comment.text }}</p>
                </div>
                <div>
                  
                </div>
                <button class="like-button" data-comment="{{ comment.id }}">
                  <a href="{% url 'like_comment' comment.id %}">
                    <img src="{% if comment.user_liked > 0 %}{% static '../../../../static/network/heart1.png' %}{% else %}{% static '../../../../static/network/heart2.png' %}{% endif %}" alt="Like">
                  </a>
                  <a class="like-count">{{ comment.likes.all.count }}</a>
                </button>
                <div>
                  <p class="comment-date">{{ comment.created_at}}</p>
                </div>
            </div>
            {% endfor %}
          </div>
    
          <form class="comment-form" method="post" action="{% url 'add_comment' post.id %}">
            {% csrf_token %}
            <div class="form-group">
              <textarea name="text" placeholder="Add Comment..." required></textarea>
            </div>
            <button type="submit">Comment</button>
          </form>
          
        </div>
      {% endfor %}
      <div class="pagination">
        <button id="prevPage" disabled>Previous</button>
        <span id="pageInfo">Page 1</span>
        <button id="nextPage">Next</button>
      </div>
    </div>
    <script>
      document.querySelectorAll('.comment-button').forEach(button => {
        button.addEventListener('click', () => {
            const postID = button.getAttribute('data-postid');
            const comments = document.querySelector(`#post-${postID} .comments`);
            if (comments.style.display === 'none' || comments.style.display === '') {
                comments.style.display = 'block';
            } else {
                comments.style.display = 'none';
            }
        });
      });
      let currentPage = 1;
      const postsPerPage = 10;
      function updatePosts() {
          const posts = document.querySelectorAll('.post');
          const totalPages = Math.ceil(posts.length / postsPerPage);
          posts.forEach((post, index) => {
              if (index < (currentPage * postsPerPage) && index >= ((currentPage - 1) * postsPerPage)) {
                  post.style.display = 'block';
              } else {
                  post.style.display = 'none';
              }
          });
          document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
          document.getElementById('prevPage').disabled = (currentPage === 1);
          document.getElementById('nextPage').disabled = (currentPage === totalPages);
      }
      document.getElementById('prevPage').addEventListener('click', () => {
          if (currentPage > 1) {
              currentPage--;
              updatePosts();
          }
      });
      document.getElementById('nextPage').addEventListener('click', () => {
          const posts = document.querySelectorAll('.post');
          const totalPages = Math.ceil(posts.length / postsPerPage);
          if (currentPage < totalPages) {
              currentPage++;
              updatePosts();
          }
      });
      
      updatePosts();
    </script>

  {% endblock %}